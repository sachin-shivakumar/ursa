# Output Contract — ExecutionAgent Monte Carlo Example

This contract defines the **required and optional on-disk artifacts** produced by the workflow in this directory.

Base directory (all relative paths):
- `work_exec_example_code/examples/execution_agent_monte_carlo/`

Typical workflow:
1. `python run_example.py` (ExecutionAgent uses `prompt.md`)
2. `python mc_option_convergence.py` (generated by the agent)
3. `python validate_outputs.py` (writes `outputs/validation.json`)

## Determinism
- Fixed RNG seed: **1337**
- Fixed parameters (expected): `S0=100, K=100, r=0.05, sigma=0.2, T=1.0`
- Required path counts: `n_paths_list = [1000, 5000, 20000, 100000]`

Validation does **not** require byte-identical logs or identical floats; it enforces structure/invariants.

## Required artifacts

### A) Generated script (required)
- Path: `./mc_option_convergence.py`
- Must exist and be non-empty.
- Must be non-interactive (validator flags `input(`).

### B) Results CSV (required)
- Path: `./outputs/results.csv`
- Format: CSV with header + rows
- Required columns (validator checks presence):
  - `n_paths, mc_price, mc_stderr, ci95_low, ci95_high, bs_price, abs_error, runtime_seconds`
- Content invariants (validator-enforced):
  - Row count between **4 and 8**.
  - `n_paths` must include at least: **1000, 5000, 20000, 100000**.
  - Numeric sanity: `mc_stderr >= 0`, `runtime_seconds >= 0`, and `ci95_low <= ci95_high`.

### C) Markdown report (required)
- Path: `./outputs/report.md`
- Required substrings (validator-enforced):
  - `Parameters`
  - either `Black–Scholes` or `Black-Scholes`
  - `Exact rerun command`
  - `python mc_option_convergence.py`
  - a summary section marker: either `## Summary` or `Summary:`

## Conditional artifact

### `outputs/plot.png` (required only if plotting enabled)
- Path: `./outputs/plot.png`
- Required if and only if `./outputs/preflight.json` has:
  - `optional.plotting_enabled == true`

## Validation output

### `outputs/validation.json`
- Written by: `validate_outputs.py`
- JSON keys:
  - `ok` (boolean)
  - `errors` (list of strings)
  - `warnings` (list of strings)
  - `details` (object; includes parsed CSV header, row counts, plotting_enabled flag)

## Expected diagnostics / metadata (allowed extras)
These may be created by the workflow and are allowed under `./outputs/`:
- `outputs/preflight.json`
- `outputs/run.log`
- `outputs/stdouterr.log` (if using `run_silent.py`)
- `outputs/run_metadata.json` (if using `run_silent.py`)
- `outputs/agent_state.json`, `outputs/agent_response.md`
- `outputs/verify.json`
- `outputs/run_error.json` (only on failure)
- `outputs/db/checkpointer.db*` (sqlite checkpointer state)

## Guardrails (policy compliance)
`validate_outputs.py` scans `mc_option_convergence.py` and key logs/state for banned patterns.
The run must not include: package installs (`pip install`, `conda install`, etc.), download tools (`curl`, `wget`), obvious network calls (`requests.get`, `urllib.request`, `socket.`), arbitrary URLs, interactive prompts (`input(`), or disallowed URSA web-search tool references.
